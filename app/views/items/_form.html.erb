<%= turbo_frame_tag dom_id(item) do %>
  <div class="bg-slate-50 dark:bg-slate-900 rounded-xl shadow-md dark:shadow-md/90 p-6">
    <%= simple_form_for(item, html: { class: "space-y-4" }) do |f| %>

      <% if item.errors.any? %>
        <div class="bg-red-600/90 text-white p-4 rounded-md">
          <strong><%= pluralize(item.errors.count, "error") %> prohibited this item from being saved:</strong>
          <ul class="mt-2 list-disc list-inside">
            <% item.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%= f.input :name,
        label_html: { class: "text-slate-200 font-medium mb-1" },
        error_html: { class: "text-red-400 text-sm mt-1" },
        input_html: {
          class: "w-full rounded-md border border-slate-600 dark:border-slate-700 bg-slate-800 text-white p-2 focus:outline-none focus:ring-2 focus:ring-teal-400"
        }
      %>

      <%= f.input :notes,
        as: :text,
        label_html: { class: "text-slate-200 font-medium mb-1" },
        error_html: { class: "text-red-400 text-sm mt-1" },
        input_html: {
          rows: 4,
          class: "w-full rounded-md border border-slate-600 dark:border-slate-700 bg-slate-800 text-white p-2 focus:outline-none focus:ring-2 focus:ring-teal-400"
        }
      %>

      <div data-controller="item-location">
        <%= f.input :box_id, as: :select,
          collection: Box.all.map { |b| [b.number, b.id] },
          include_blank: "Select a box (or leave blank to pick a room)",
          label: "Box",
          label_html: { class: "text-slate-200 font-medium mb-1" },
          error_html: { class: "text-red-400 text-sm mt-1" },
          input_html: {
            data: { action: "change->item-location#toggle" },
            class: "w-full rounded-md border border-slate-600 bg-slate-800 text-white p-2"
          }
        %>

        <div data-item-location-target="roomSelectWrapper" class="<%= f.object.box_id.present? ? 'hidden' : '' %> transition-all ease-in-out duration-300 mt-2">
          <%= f.input :room_id, as: :select,
            collection: Room.all.map { |r| [r.name.capitalize, r.id] },
            include_blank: "Select a room",
            label: "Room",
            label_html: { class: "text-slate-200 font-medium mb-1" },
            error_html: { class: "text-red-400 text-sm mt-1" },
            input_html: {
              class: "w-full rounded-md border border-slate-600 bg-slate-800 text-white p-2",
              data: { item_location_target: "roomSelect" }
            }
          %>
        </div>
      </div>

      <%= f.input :image,
        as: :file,
        label: "Image",
        label_html: { class: "text-slate-200 font-medium mb-1" },
        error_html: { class: "text-red-400 text-sm mt-1" },
        input_html: {
          direct_upload: true,
          class: "w-full file:bg-teal-600 file:text-white file:px-4 file:py-2 file:rounded file:cursor-pointer file:border-0 bg-slate-800 text-slate-200 rounded-md border border-slate-600"
        }
      %>

      <div class="flex justify-between pt-4">
        <%= link_to "Cancel", item_path(item, closed: false, format: :turbo_stream),
              data: { turbo_frame: dom_id(item) },
              class: "bg-slate-700 hover:bg-slate-600 text-white px-4 py-2 rounded shadow-sm" %>
        <%= f.button :submit, "Update Item", class: "bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded shadow-sm" %>
      </div>

    <% end %>
  </div>
<% end %>
